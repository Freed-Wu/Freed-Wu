#!/usr/bin/env perl
use Env qw(GITHUB_REF_NAME);
use File::Copy 'cp';
use ExtUtils::MakeMaker;

cp 'MANIFEST.SKIP.bak', 'MANIFEST.SKIP';
if ( defined $GITHUB_REF_NAME ) {
    $VERSION = $GITHUB_REF_NAME;
}
else {
    $VERSION = `git describe --abbrev=0`;
    chomp $VERSION;
}
$VERSION = '0.0.0' if $VERSION eq '';

WriteMakefile(
    NAME          => '{{ substitute(substitute(expand('%:p:h:t'), '\%(-\|^\)\(.\)', '::\u\1', 'g'), '^::', '', 'g') }}',
    LICENSE       => 'gpl_3',
    AUTHOR        => '{{ g:snips_author }} <{{ g:snips_email }}>',
    VERSION       => $VERSION,
    ABSTRACT_FROM => '{{ expand('%:p:h:t') }}.PL',
    EXE_FILES     => ['{{ expand('%:p:h:t') }}'],
);
